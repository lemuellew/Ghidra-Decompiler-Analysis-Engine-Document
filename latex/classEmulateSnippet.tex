\hypertarget{classEmulateSnippet}{}\doxysection{Emulate\+Snippet Class Reference}
\label{classEmulateSnippet}\index{EmulateSnippet@{EmulateSnippet}}


\mbox{\hyperlink{classEmulate}{Emulate}} a {\itshape snippet} of Pcode\+Ops out of a functional context.  




{\ttfamily \#include $<$emulateutil.\+hh$>$}



Inheritance diagram for Emulate\+Snippet\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=174pt]{classEmulateSnippet__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Emulate\+Snippet\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=202pt]{classEmulateSnippet__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classEmulateSnippet_af333890e0d9a94efbd3557070a829a44}\label{classEmulateSnippet_af333890e0d9a94efbd3557070a829a44}} 
virtual \mbox{\hyperlink{classEmulateSnippet_af333890e0d9a94efbd3557070a829a44}{$\sim$\+Emulate\+Snippet}} (void)
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classEmulateSnippet_a22a13101a25f73f33a9b10f20ebf018a}\label{classEmulateSnippet_a22a13101a25f73f33a9b10f20ebf018a}} 
virtual void \mbox{\hyperlink{classEmulateSnippet_a22a13101a25f73f33a9b10f20ebf018a}{set\+Execute\+Address}} (const \mbox{\hyperlink{classAddress}{Address}} \&addr)
\begin{DoxyCompactList}\small\item\em Set the address of the next instruction to emulate. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classEmulateSnippet_aef11e510794c009453333e847acc38e9}\label{classEmulateSnippet_aef11e510794c009453333e847acc38e9}} 
virtual \mbox{\hyperlink{classAddress}{Address}} \mbox{\hyperlink{classEmulateSnippet_aef11e510794c009453333e847acc38e9}{get\+Execute\+Address}} (void) const
\begin{DoxyCompactList}\small\item\em Get the address of the current instruction being executed. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classEmulateSnippet_a243812d9450f7d70610e23924def533f}{reset\+Memory}} (void)
\begin{DoxyCompactList}\small\item\em Reset the emulation snippet. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classPcodeEmit}{Pcode\+Emit}} $\ast$ \mbox{\hyperlink{classEmulateSnippet_ad45023c5e4a7170496ef8acc48835d32}{build\+Emitter}} (const vector$<$ \mbox{\hyperlink{classOpBehavior}{Op\+Behavior}} $\ast$ $>$ \&inst, uintb uniq\+Reserve)
\begin{DoxyCompactList}\small\item\em Provide the caller with an emitter for building the p-\/code snippet. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classEmulateSnippet_ad83f137b630e90877b05ea13f8d1d1be}{check\+For\+Legal\+Code}} (void) const
\begin{DoxyCompactList}\small\item\em Check for p-\/code that is deemed illegal for a {\itshape snippet}. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classEmulateSnippet_ace37ff31a80e1f296221195eeec4a4fb}{set\+Current\+Op}} (int4 i)
\begin{DoxyCompactList}\small\item\em Set the current executing p-\/code op by index. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classEmulateSnippet_abc4c1bf018f8ab3c0cea77fa927f5968}{set\+Varnode\+Value}} (uintb offset, uintb val)
\begin{DoxyCompactList}\small\item\em Set a temporary register value in the machine state. \end{DoxyCompactList}\item 
uintb \mbox{\hyperlink{classEmulateSnippet_af19946de88e6ea7dbf396648640fdb97}{get\+Varnode\+Value}} (\mbox{\hyperlink{structVarnodeData}{Varnode\+Data}} $\ast$vn) const
\begin{DoxyCompactList}\small\item\em Retrieve the value of a \mbox{\hyperlink{classVarnode}{Varnode}} from the current machine state. \end{DoxyCompactList}\item 
uintb \mbox{\hyperlink{classEmulateSnippet_a77a5c0e4b9085b84e2d487568f9aa484}{get\+Temp\+Value}} (uintb offset) const
\begin{DoxyCompactList}\small\item\em Retrieve a temporary register value directly. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\mbox{\hyperlink{classEmulate}{Emulate}} a {\itshape snippet} of Pcode\+Ops out of a functional context. 

Emulation is performed on a short sequence ({\bfseries{snippet}}) of \mbox{\hyperlink{classPcodeOpRaw}{Pcode\+Op\+Raw}} objects. Control-\/flow emulation is limited to this snippet; B\+R\+A\+N\+CH and C\+B\+R\+A\+N\+CH operations can happen using p-\/code relative branching. Executing B\+R\+A\+N\+C\+H\+I\+ND, C\+A\+LL, C\+A\+L\+L\+I\+ND, C\+A\+L\+L\+O\+T\+H\+ER, S\+T\+O\+RE, M\+U\+L\+T\+I\+E\+Q\+U\+AL, I\+N\+D\+I\+R\+E\+CT, S\+E\+G\+M\+E\+N\+T\+OP, C\+P\+O\+O\+L\+OP, and N\+EW ops is treated as illegal and an exception is thrown. Expressions can only use temporary registers or read from the \mbox{\hyperlink{classLoadImage}{Load\+Image}}.

The set of \mbox{\hyperlink{classPcodeOpRaw}{Pcode\+Op\+Raw}} objects in the snippet is provided by emitting p-\/code to the object returned by \mbox{\hyperlink{classEmulateSnippet_ad45023c5e4a7170496ef8acc48835d32}{build\+Emitter()}}. This is designed for one-\/time initialization of this class, which can be repeatedly used by calling \mbox{\hyperlink{classEmulateSnippet_a243812d9450f7d70610e23924def533f}{reset\+Memory()}} between executions. 

\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classEmulateSnippet_ad45023c5e4a7170496ef8acc48835d32}\label{classEmulateSnippet_ad45023c5e4a7170496ef8acc48835d32}} 
\index{EmulateSnippet@{EmulateSnippet}!buildEmitter@{buildEmitter}}
\index{buildEmitter@{buildEmitter}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{buildEmitter()}{buildEmitter()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classPcodeEmit}{Pcode\+Emit}} $\ast$ Emulate\+Snippet\+::build\+Emitter (\begin{DoxyParamCaption}\item[{const vector$<$ \mbox{\hyperlink{classOpBehavior}{Op\+Behavior}} $\ast$ $>$ \&}]{inst,  }\item[{uintb}]{uniq\+Reserve }\end{DoxyParamCaption})}



Provide the caller with an emitter for building the p-\/code snippet. 

Any p-\/code produced by the \mbox{\hyperlink{classPcodeEmit}{Pcode\+Emit}}, when triggered by the caller, becomes part of the {\itshape snippet} that will get emulated by {\bfseries{this}}. The caller should free the \mbox{\hyperlink{classPcodeEmit}{Pcode\+Emit}} object immediately after use. 
\begin{DoxyParams}{Parameters}
{\em inst} & is the {\itshape opcode} to {\itshape behavior} map the emitter will use \\
\hline
{\em uniq\+Reserve} & is the starting offset within the {\itshape unique} address space for any temporary registers \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the newly constructed emitter 
\end{DoxyReturn}
\mbox{\Hypertarget{classEmulateSnippet_ad83f137b630e90877b05ea13f8d1d1be}\label{classEmulateSnippet_ad83f137b630e90877b05ea13f8d1d1be}} 
\index{EmulateSnippet@{EmulateSnippet}!checkForLegalCode@{checkForLegalCode}}
\index{checkForLegalCode@{checkForLegalCode}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{checkForLegalCode()}{checkForLegalCode()}}
{\footnotesize\ttfamily bool Emulate\+Snippet\+::check\+For\+Legal\+Code (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption}) const}



Check for p-\/code that is deemed illegal for a {\itshape snippet}. 

This method facilitates enforcement of the formal rules for snippet code.
\begin{DoxyItemize}
\item Branches must use p-\/code relative addressing.
\item Snippets can only read/write from temporary registers
\item Snippets cannot use B\+R\+A\+N\+C\+H\+I\+ND, C\+A\+LL, C\+A\+L\+L\+I\+ND, C\+A\+L\+L\+O\+T\+H\+ER, S\+T\+O\+RE, S\+E\+G\+M\+E\+N\+T\+OP, C\+P\+O\+O\+L\+R\+EF, N\+EW, M\+U\+L\+T\+I\+E\+Q\+U\+AL, or I\+N\+D\+I\+R\+E\+CT
\end{DoxyItemize}

\begin{DoxyReturn}{Returns}
{\bfseries{true}} if the current snippet is legal 
\end{DoxyReturn}
\mbox{\Hypertarget{classEmulateSnippet_a77a5c0e4b9085b84e2d487568f9aa484}\label{classEmulateSnippet_a77a5c0e4b9085b84e2d487568f9aa484}} 
\index{EmulateSnippet@{EmulateSnippet}!getTempValue@{getTempValue}}
\index{getTempValue@{getTempValue}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{getTempValue()}{getTempValue()}}
{\footnotesize\ttfamily uintb Emulate\+Snippet\+::get\+Temp\+Value (\begin{DoxyParamCaption}\item[{uintb}]{offset }\end{DoxyParamCaption}) const}



Retrieve a temporary register value directly. 

This allows the user to obtain the final value of the snippet calculation, without having to have the \mbox{\hyperlink{classVarnode}{Varnode}} object in hand. 
\begin{DoxyParams}{Parameters}
{\em offset} & is the offset of the temporary register to retrieve \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the calculated value or 0 if the register was never written 
\end{DoxyReturn}
\mbox{\Hypertarget{classEmulateSnippet_af19946de88e6ea7dbf396648640fdb97}\label{classEmulateSnippet_af19946de88e6ea7dbf396648640fdb97}} 
\index{EmulateSnippet@{EmulateSnippet}!getVarnodeValue@{getVarnodeValue}}
\index{getVarnodeValue@{getVarnodeValue}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{getVarnodeValue()}{getVarnodeValue()}}
{\footnotesize\ttfamily uintb Emulate\+Snippet\+::get\+Varnode\+Value (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structVarnodeData}{Varnode\+Data}} $\ast$}]{vn }\end{DoxyParamCaption}) const}



Retrieve the value of a \mbox{\hyperlink{classVarnode}{Varnode}} from the current machine state. 

If the \mbox{\hyperlink{classVarnode}{Varnode}} is a temporary registers, the storage offset is used to look up the value from the machine state cache. If the \mbox{\hyperlink{classVarnode}{Varnode}} represents a R\+AM location, the value is pulled directly out of the load-\/image. If the value does not exist, a \char`\"{}\+Read before write\char`\"{} exception is thrown. 
\begin{DoxyParams}{Parameters}
{\em vn} & is the \mbox{\hyperlink{classVarnode}{Varnode}} to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the retrieved value 
\end{DoxyReturn}
\mbox{\Hypertarget{classEmulateSnippet_a243812d9450f7d70610e23924def533f}\label{classEmulateSnippet_a243812d9450f7d70610e23924def533f}} 
\index{EmulateSnippet@{EmulateSnippet}!resetMemory@{resetMemory}}
\index{resetMemory@{resetMemory}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{resetMemory()}{resetMemory()}}
{\footnotesize\ttfamily void Emulate\+Snippet\+::reset\+Memory (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Reset the emulation snippet. 

Reset the memory state, and set the first p-\/code op as current. \mbox{\Hypertarget{classEmulateSnippet_ace37ff31a80e1f296221195eeec4a4fb}\label{classEmulateSnippet_ace37ff31a80e1f296221195eeec4a4fb}} 
\index{EmulateSnippet@{EmulateSnippet}!setCurrentOp@{setCurrentOp}}
\index{setCurrentOp@{setCurrentOp}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{setCurrentOp()}{setCurrentOp()}}
{\footnotesize\ttfamily void Emulate\+Snippet\+::set\+Current\+Op (\begin{DoxyParamCaption}\item[{int4}]{i }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set the current executing p-\/code op by index. 

The i-\/th p-\/code op in the snippet sequence is set as the currently executing op. 
\begin{DoxyParams}{Parameters}
{\em i} & is the index \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classEmulateSnippet_abc4c1bf018f8ab3c0cea77fa927f5968}\label{classEmulateSnippet_abc4c1bf018f8ab3c0cea77fa927f5968}} 
\index{EmulateSnippet@{EmulateSnippet}!setVarnodeValue@{setVarnodeValue}}
\index{setVarnodeValue@{setVarnodeValue}!EmulateSnippet@{EmulateSnippet}}
\doxysubsubsection{\texorpdfstring{setVarnodeValue()}{setVarnodeValue()}}
{\footnotesize\ttfamily void Emulate\+Snippet\+::set\+Varnode\+Value (\begin{DoxyParamCaption}\item[{uintb}]{offset,  }\item[{uintb}]{val }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set a temporary register value in the machine state. 

The temporary \mbox{\hyperlink{classVarnode}{Varnode}}\textquotesingle{}s storage offset is used as key into the machine state map. 
\begin{DoxyParams}{Parameters}
{\em offset} & is the temporary storage offset \\
\hline
{\em val} & is the value to put into the machine state \\
\hline
\end{DoxyParams}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{emulateutil_8hh}{emulateutil.\+hh}}\item 
emulateutil.\+cc\end{DoxyCompactItemize}
